# Ladybird

[English](README.md) / [日本語](README.ja.md) / [简体中文](README.zh-CN.md)

---

## 概要

Ladybird は、Web ページにノーコードのボタン・リンク・ツールチップ・エリア・自動化フローを追加できる Manifest V3 ブラウザ拡張です。

このリポジトリは現在、**WXT ベース実装を主系統（メインライン）**として使用しています（以前は `wxt-temp/` 配下で開発）。旧ルート実装は `legacy/v1/` にアーカイブされています。

主な機能:
- サイドパネル管理（`Elements` / `Flows` / `Hidden` / `Overview` / `Settings`）
- アクションフロービルダー（`click`, `wait`, `input`, `navigate`, `log`, `if`, `while`, `popup`）
- フロー用パスワード保管庫（Password Vault）
- インポート / エクスポート（保管庫データの任意エクスポートを含む）
- 多言語 UI（`en`, `ja`, `zh_CN`）

## Chrome Web Store

https://chromewebstore.google.com/detail/ladybird-no-code-buttons/nefpepdpcjejamkgpndlfehkffkfgbpe


## クイックスタート（WXT メインライン）

リポジトリのルートで実行してください。

### 依存関係のインストール
```bash
npm install
```

### 開発
```bash
npm run dev
```

### 検証とビルド
```bash
npm run i18n:check
npm run compile
npm run build
```

### 配布用 zip の作成
```bash
npm run zip
```

### Chrome へ読み込み（開発）
未パッケージ拡張を以下から読み込み:
- `.output/chrome-mv3/`

## 使い方

1. アクティブなタブで Ladybird のサイドパネルを開きます。
2. **Elements** で要素（ボタン / リンク / ツールチップ / エリア）を作成・編集します。
3. **Flows** で自動化フローを紐付けます。
4. **Hidden** でページ要素を非表示にします。
5. **Overview** で保存済みサイトデータを確認・削除します。
6. **Settings** でインポート/エクスポート、言語、パスワード保管庫の閲覧を行います。

### パスワード保管庫（Flows）
- パスワード入力ステップの紐付けは Password Vault UI を使ってください。
- パスワード欄はフロー内への平文保存がブロックされます。
- 実行中に保管庫がロックされている場合、ページ上で解錠を促し、そのステップから続行できます。
- 保管庫パスワードを忘れた場合、**復元はできません**。リセットが必要です（保存済みパスワードは削除されます）。

## アクションフロー（概要）

フローは注入ボタンのクリック時に実行され、リンク遷移やセレクター動作のフォールバック前にページ操作を自動化できます。

主なステップ種別:
- `click`
- `wait`
- `input`
- `navigate`
- `log`
- `if` / `while`
- `popup`

ステップ項目、条件、実行制限、frame 動作、保管庫利用の詳細は `AGENTS.md` の Action Flow Reference を参照してください。

## 旧版からの移行（重要）

旧ルート実装は以下へ移動しました:
- `legacy/v1/`

### 同一掲載での既存ユーザーアップグレード

今回は **同じ Chrome Web Store 掲載 / 同じ拡張 ID** を使うため、ブラウザのローカルストレージは同じ拡張の領域を継続して使用します。

Ladybird には、旧形式の保存データ（例: `injectedElements`）を新しい構造化ストレージへ移行する互換ロジックが含まれています。

リリース前・サポート時の推奨:
1. 公開前に実データでアップグレード検証を行う
2. 手動復旧手段としてインポート/エクスポートを維持する
3. Password Vault データを扱う場合:
   - エクスポート時に保管庫パスワードを含めるか選択（確認のため保管庫パスワード入力が必要）
   - インポート時は保管庫の作成/解錠が必要な場合があります

注意:
- 保管庫パスワードを忘れた場合、保存済みパスワードは復元できません。
- 保管庫をリセットすると保存済みパスワードは削除されますが、フローの紐付け自体は残るため再紐付けが必要です。

## リポジトリ構成

### WXTバージョン
- `entrypoints/` バックグラウンド / コンテンツスクリプトのエントリポイント
- `ui/` サイドパネル UI
- `shared/` 契約、ストレージ、インポート/エクスポート、Secrets
- `public/_locales/` i18n メッセージ
- `scripts/` 開発・検証スクリプト

### 旧版アーカイブ
- `legacy/v1/` 旧ルート実装（参照 / メンテ用）

### 補助資料
- `docs/` ドキュメント / ポリシー
- `release/` 過去の成果物、レビュー資料、ストア用素材

## 開発メモ / 貢献

以下は `AGENTS.md` を参照してください:
- リポジトリ規約
- ビルド / リリース手順
- i18n ルール
- アクションフロー参考

## プライバシー / 制約

- 明示的にエクスポートしない限り、データは `chrome.storage.local` に保存されます。
- Password Vault の秘密情報はローカルで暗号化され、利用時は保管庫パスワードが必要です。
- クロスオリジン iframe の自動化はサポートしていません。
- 厳しい CSP や変化の激しい DOM を持つサイトでは注入の安定性が下がる場合があります。
